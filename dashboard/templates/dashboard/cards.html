<div class="d-flex flex-column gap-3 h-100">

    <div class="hud-card position-relative overflow-hidden flex-shrink-0" 
         style="min-height: 110px; border-left-color: var(--neon-green);">
        
        {% if spotify and spotify.tocando %}
            <div style="position: absolute; inset: 0; background: url('{{ spotify.capa }}') center/cover; filter: blur(15px); opacity: 0.3;"></div>
            
            <div class="d-flex align-items-center p-3 h-100 position-relative" style="z-index: 2;">
                <img src="{{ spotify.capa }}" class="rounded shadow me-3 border border-secondary" style="height: 80px; width: 80px;">
                
                <div class="flex-grow-1 overflow-hidden">
                    <h4 class="mb-0 fw-bold text-white text-truncate">{{ spotify.nome }}</h4>
                    <p class="text-info mb-1 text-truncate">{{ spotify.artista }}</p>
                    
                    <div class="progress bg-dark bg-opacity-50 mt-2" style="height: 5px;">
                        <div class="progress-bar bg-success" style="width: {{ spotify.percent }}%"></div>
                    </div>
                </div>

                <div class="d-flex gap-2 ms-3">
                    <button class="btn btn-outline-light rounded-circle" hx-get="/comando/prev" hx-swap="none"><i class="bi bi-skip-backward-fill"></i></button>
                    <button class="btn btn-outline-success rounded-circle" hx-get="/comando/play" hx-swap="none"><i class="bi bi-pause-fill"></i></button>
                    <button class="btn btn-outline-light rounded-circle" hx-get="/comando/next" hx-swap="none"><i class="bi bi-skip-forward-fill"></i></button>
                </div>
            </div>
        {% else %}
            <div class="d-flex align-items-center justify-content-center h-100 text-white-50">
                <i class="bi bi-spotify fs-2 me-3"></i>
                <div>
                    <h5 class="mb-0">Spotify Ready</h5>
                    <small>Selecione uma playlist no menu lateral</small>
                </div>
            </div>
        {% endif %}
    </div>

    <div class="hud-card p-3 flex-grow-1 d-flex flex-column" style="border-left-color: var(--neon-blue);">
        <div class="row g-0 h-100">
            
            <div class="col-md-4 border-end border-secondary border-opacity-25 pe-3 d-flex flex-column justify-content-center">
                <div class="mb-4">
                    <div class="d-flex justify-content-between align-items-end mb-1">
                        <span class="label-tech"><i class="bi bi-cpu"></i> Processador</span>
                        <span class="fw-bold {% if sistema.cpu > 80 %}text-danger{% else %}text-info{% endif %}">{{ sistema.cpu }}%</span>
                    </div>
                    <div class="progress bg-dark" style="height: 6px;">
                        <div class="progress-bar bg-info" style="width: {{ sistema.cpu }}%"></div>
                    </div>
                </div>
                <div>
                    <div class="d-flex justify-content-between align-items-end mb-1">
                        <span class="label-tech"><i class="bi bi-memory"></i> Memória RAM</span>
                        <span class="fw-bold text-white">{{ sistema.ram_used }} <span class="text-secondary small">/ {{ sistema.ram_total }}G</span></span>
                    </div>
                    <div class="progress bg-dark" style="height: 6px;">
                        <div class="progress-bar" style="width: {{ sistema.ram_percent }}%; background-color: var(--neon-purple);"></div>
                    </div>
                </div>
            </div>

            <div class="col-md-4 border-end border-secondary border-opacity-25 px-3 d-flex flex-column justify-content-center">
                
                <div class="mb-3">
                    {% for disco in sistema.discos %}
                    <div class="d-flex justify-content-between align-items-center mb-1">
                        <span class="label-tech mb-0">{{ disco.letra }} ({{ disco.tipo }})</span>
                        <small class="{% if disco.percent > 90 %}text-danger{% else %}text-white-50{% endif %}">{{ disco.percent }}%</small>
                    </div>
                    <div class="progress bg-dark mb-2" style="height: 4px;">
                        <div class="progress-bar {% if disco.letra == 'C:\\' %}bg-primary{% else %}bg-secondary{% endif %}" style="width: {{ disco.percent }}%"></div>
                    </div>
                    {% endfor %}
                </div>

                <div>
                    <span class="label-tech">Conexão ({{ sistema.rede.ping }}ms)</span>
                    <div class="row g-1 mt-1">
                        <div class="col-6">
                            <div class="bg-white bg-opacity-10 p-1 rounded text-center">
                                <i class="bi bi-download text-info small"></i>
                                <span class="d-block fw-bold small">{{ sistema.rede.download_mbps }}</span>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="bg-white bg-opacity-10 p-1 rounded text-center">
                                <i class="bi bi-upload text-warning small"></i>
                                <span class="d-block fw-bold small">{{ sistema.rede.upload_mbps }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-4 ps-3 d-flex flex-column justify-content-center align-items-center text-center">
                {% if sistema.gpu %}
                    <span class="label-tech mb-2 text-warning">{{ sistema.gpu.nome|truncatechars:20 }}</span>
                    
                    <div class="position-relative mb-2" style="width: 70px; height: 70px; display: flex; align-items: center; justify-content: center; border-radius: 50%; background: conic-gradient(var(--neon-red) {{ sistema.gpu.load }}%, #222 0); box-shadow: 0 0 15px rgba(255,0,0,0.2);">
                        <div style="width: 58px; height: 58px; background: #0b0b0b; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <span class="fs-4 fw-bold">{{ sistema.gpu.temp }}°</span>
                        </div>
                    </div>
                    
                    <div class="w-100 px-2">
                        <div class="d-flex justify-content-between small text-muted">
                            <span>Load: {{ sistema.gpu.load }}%</span>
                            <span>VRAM: {{ sistema.gpu.mem_used }}G</span>
                        </div>
                        <div class="progress bg-dark mt-1" style="height: 4px;">
                            <div class="progress-bar bg-warning" style="width: {{ sistema.gpu.load }}%"></div>
                        </div>
                    </div>
                {% else %}
                    <span class="text-muted">Sem GPU Dedicada</span>
                {% endif %}
            </div>

        </div>
    </div>

    <div class="hud-card px-3 py-2 flex-shrink-0" style="border-left-color: var(--neon-purple); min-height: 45px;">
        <div class="d-flex align-items-center h-100 overflow-hidden">
            <span class="label-tech me-3 border-end border-secondary pe-3 d-none d-md-block">MARKET</span>
            <div class="d-flex align-items-center gap-3 overflow-x-auto" style="white-space: nowrap; scrollbar-width: none;">
                {% for moeda in cryptos %}
                <div class="d-flex align-items-center bg-white bg-opacity-5 rounded px-2 py-1" style="border: 1px solid rgba(255,255,255,0.05);">
                    <img src="{{ moeda.image }}" width="14" class="me-2 rounded-circle">
                    <span class="fw-bold me-2 small">{{ moeda.symbol|upper }}</span>
                    <span class="small me-2 text-info">${{ moeda.current_price|floatformat:0 }}</span>
                    <small class="{% if moeda.price_change_percentage_24h > 0 %}text-success{% else %}text-danger{% endif %}" style="font-size: 0.7rem;">
                        {{ moeda.price_change_percentage_24h|floatformat:1 }}%
                    </small>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

</div>