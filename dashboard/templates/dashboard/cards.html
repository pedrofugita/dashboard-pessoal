<div class="d-flex flex-column gap-3 h-100">

    <div class="glass-panel position-relative overflow-hidden flex-shrink-0 d-flex align-items-end p-0" 
         style="height: 140px; border: 0;">
        
        {% if spotify and spotify.tocando %}
            <div style="position: absolute; inset: 0; background: url('{{ spotify.capa }}') center/cover; filter: blur(15px) brightness(0.4); z-index: 0;"></div>
            
            <div class="d-flex w-100 p-3 align-items-center position-relative" style="z-index: 1;">
                <img src="{{ spotify.capa }}" class="rounded-3 shadow-lg me-3" style="height: 90px; width: 90px; border: 1px solid rgba(255,255,255,0.2);">
                
                <div class="flex-grow-1 overflow-hidden">
                    <span class="badge bg-success bg-opacity-75 mb-1" style="font-size: 0.6rem; letter-spacing: 1px;">SPOTIFY CONNECT</span>
                    <h3 class="mb-0 fw-bold text-white text-truncate" style="font-family: 'Rajdhani'; font-size: 1.8rem; text-shadow: 0 2px 10px rgba(0,0,0,0.5);">{{ spotify.nome }}</h3>
                    <p class="text-white-50 mb-2 text-truncate font-monospace small">{{ spotify.artista }}</p>
                    
                    <div class="progress bg-white bg-opacity-10" style="height: 3px;">
                        <div class="progress-bar bg-success box-shadow-glow" style="width: {{ spotify.percent }}%"></div>
                    </div>
                </div>
                
                <div class="d-flex flex-column gap-2 ms-3">
                    <button class="btn btn-sm btn-outline-light rounded-circle border-0 bg-white bg-opacity-10 backdrop-blur" hx-get="/comando/next" hx-swap="none"><i class="bi bi-skip-forward-fill"></i></button>
                    <button class="btn btn-sm btn-outline-light rounded-circle border-0 bg-white bg-opacity-10 backdrop-blur" hx-get="/comando/play" hx-swap="none"><i class="bi bi-pause-fill"></i></button>
                </div>
            </div>
        {% else %}
            <div class="d-flex align-items-center justify-content-center w-100 h-100 bg-dark bg-opacity-50">
                <div class="text-center text-white-50">
                    <i class="bi bi-vinyl fs-1 opacity-25"></i>
                    <p class="small mt-2 font-monospace">AGUARDANDO SINAL DE ÁUDIO...</p>
                </div>
            </div>
        {% endif %}
    </div>

    <div class="flex-grow-1 d-grid gap-3" style="grid-template-columns: 1fr 1fr 1fr;">
        
        <div class="glass-panel p-3 position-relative d-flex flex-column justify-content-between overflow-hidden" style="border-top: 2px solid var(--neon-cyan);">
            <i class="bi bi-cpu position-absolute" style="font-size: 8rem; right: -20px; bottom: -20px; opacity: 0.05; transform: rotate(-15deg);"></i>
            
            <svg class="position-absolute start-0 bottom-0 w-100 h-50" style="opacity: 0.1; pointer-events: none;" preserveAspectRatio="none">
                <path d="M0,50 Q20,40 40,60 T80,40 T120,70 T160,30 T200,50 L200,100 L0,100 Z" fill="var(--neon-cyan)" />
                <path d="M0,50 Q20,40 40,60 T80,40 T120,70 T160,30 T200,50" fill="none" stroke="var(--neon-cyan)" stroke-width="2" />
            </svg>

            <div>
                <span class="label-tech glow-text-cyan">CPU CORE</span>
                <div class="d-flex align-items-baseline">
                    <span class="display-4 fw-bold val-tech text-white">{{ sistema.cpu }}</span>
                    <span class="fs-5 text-secondary ms-1">%</span>
                </div>
            </div>
            
            <div class="mt-3">
                <div class="d-flex justify-content-between mb-1">
                    <span class="small font-monospace text-white-50">RAM LOAD</span>
                    <span class="small font-monospace text-white">{{ sistema.ram_used }}G</span>
                </div>
                <div class="progress bg-dark" style="height: 6px;">
                    <div class="progress-bar" style="width: {{ sistema.ram_percent }}%; background-color: var(--neon-cyan); box-shadow: 0 0 10px var(--neon-cyan);"></div>
                </div>
            </div>
        </div>

        <div class="glass-panel p-3 position-relative d-flex flex-column justify-content-between overflow-hidden" style="border-top: 2px solid var(--neon-purple);">
            <i class="bi bi-hdd-network position-absolute" style="font-size: 8rem; right: -20px; bottom: -20px; opacity: 0.05;"></i>

            <div>
                <span class="label-tech glow-text-pink">STORAGE & NET</span>
                {% for disco in sistema.discos %}
                    <div class="mb-2 position-relative" style="z-index: 1;">
                        <div class="d-flex justify-content-between small mb-1">
                            <span class="font-monospace text-white-50">{{ disco.letra }} [{{ disco.tipo }}]</span>
                            <span class="font-monospace {% if disco.percent > 90 %}text-danger{% else %}text-white{% endif %}">{{ disco.percent }}%</span>
                        </div>
                        <div class="progress bg-dark" style="height: 4px;">
                            <div class="progress-bar bg-light" style="width: {{ disco.percent }}%"></div>
                        </div>
                    </div>
                {% endfor %}
            </div>

            <div class="row g-2 mt-2">
                <div class="col-6">
                    <div class="p-2 rounded bg-dark bg-opacity-50 text-center border border-secondary border-opacity-25">
                        <i class="bi bi-arrow-down-short text-info"></i>
                        <span class="d-block val-tech fs-6">{{ sistema.rede.download_mbps }}</span>
                    </div>
                </div>
                <div class="col-6">
                    <div class="p-2 rounded bg-dark bg-opacity-50 text-center border border-secondary border-opacity-25">
                        <i class="bi bi-arrow-up-short text-warning"></i>
                        <span class="d-block val-tech fs-6">{{ sistema.rede.upload_mbps }}</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="glass-panel p-3 position-relative d-flex flex-column text-center justify-content-center" style="border-top: 2px solid var(--neon-yellow);">
            <i class="bi bi-gpu-card position-absolute" style="font-size: 8rem; left: 50%; top: 50%; transform: translate(-50%, -50%); opacity: 0.03;"></i>

            <span class="label-tech text-warning mb-3">{{ sistema.gpu.nome|default:"NO GPU DETECTED" }}</span>
            
            {% if sistema.gpu %}
                <div class="position-relative mx-auto mb-3" style="width: 100px; height: 100px;">
                    <div class="position-absolute w-100 h-100 rounded-circle" 
                         style="border: 2px dashed rgba(255,255,255,0.2); animation: spin 10s linear infinite;"></div>
                    
                    <div class="position-absolute w-100 h-100 rounded-circle d-flex align-items-center justify-content-center"
                         style="background: conic-gradient(var(--neon-yellow) {{ sistema.gpu.load }}%, transparent 0);">
                        <div class="bg-dark rounded-circle d-flex flex-column align-items-center justify-content-center" style="width: 85px; height: 85px;">
                            <span class="display-6 fw-bold val-tech text-white">{{ sistema.gpu.temp }}°</span>
                            <span class="small text-muted" style="font-size: 0.6rem;">TEMP</span>
                        </div>
                    </div>
                </div>

                <div class="row g-1 w-100 px-2">
                    <div class="col-6 text-start">
                        <span class="label-tech mb-0">VRAM</span>
                        <small class="val-tech text-white">{{ sistema.gpu.mem_used }}G</small>
                        <div class="progress bg-dark mt-1" style="height: 3px;">
                            <div class="progress-bar bg-warning" style="width: {{ sistema.gpu.load }}%"></div>
                        </div>
                    </div>
                    <div class="col-6 text-end">
                        <span class="label-tech mb-0">FAN</span>
                        <small class="val-tech text-white">AUTO</small>
                        <div class="progress bg-dark mt-1" style="height: 3px;">
                            <div class="progress-bar bg-success" style="width: 60%"></div>
                        </div>
                    </div>
                </div>
            {% else %}
                <span class="text-white-50 my-auto">iGPU MODE</span>
            {% endif %}
        </div>

    </div>

    <div class="glass-panel px-3 py-2 flex-shrink-0 d-flex align-items-center" style="height: 60px; border-left: 0; border-bottom: 2px solid var(--neon-green);">
        <span class="label-tech me-3 border-end border-light border-opacity-10 pe-3 d-none d-md-block my-0">MARKET DATA</span>
        
        <div class="d-flex align-items-center gap-3 overflow-x-auto h-100" style="scrollbar-width: none;">
            {% for moeda in cryptos %}
            <div class="d-flex align-items-center bg-black bg-opacity-40 rounded px-3 py-1 border border-light border-opacity-10">
                <img src="{{ moeda.image }}" width="18" class="me-2 rounded-circle grayscale">
                <span class="fw-bold me-2 small font-monospace">{{ moeda.symbol|upper }}</span>
                <span class="small me-2 text-white font-monospace">${{ moeda.current_price|floatformat:0 }}</span>
                
                {% if moeda.price_change_percentage_24h > 0 %}
                    <i class="bi bi-caret-up-fill text-success" style="font-size: 0.7rem;"></i>
                    <small class="text-success font-monospace">{{ moeda.price_change_percentage_24h|floatformat:1 }}%</small>
                {% else %}
                    <i class="bi bi-caret-down-fill text-danger" style="font-size: 0.7rem;"></i>
                    <small class="text-danger font-monospace">{{ moeda.price_change_percentage_24h|floatformat:1 }}%</small>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>

</div>

<style>
    @keyframes spin { 100% { transform: rotate(360deg); } }
    .grayscale { filter: grayscale(100%); transition: filter 0.3s; }
    .grayscale:hover { filter: grayscale(0%); }
    .box-shadow-glow { box-shadow: 0 0 10px rgba(255, 255, 255, 0.5); }
</style>